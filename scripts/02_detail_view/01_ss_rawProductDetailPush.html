<script>

    var currentPageURL = document.URL;
    
  	// this will match any product detail page
  	// the regex makes sure that "/store/" plus at least one character is in the URL
    if(currentPageURL.match(/\/store\/./)){
        // create a variable to hold our product information
        var ssContextObject;

        // grab all the scripts that have been loaded on the page thus far
        var ssAllScripts = document.querySelectorAll('script');

        // look for the one that has the checkout information we need
        for (var scriptIndex = 0; scriptIndex < ssAllScripts.length; scriptIndex++) {
            // the .match method returns 'null' if it doesn't find a match
            var ssContextObjectScriptHTML = ssAllScripts[scriptIndex].innerHTML.match(/Static\.SQUARESPACE_CONTEXT = (.+?)\};/);
        
            // if the match function above returned something, then we parse it as JSON and store it in our JSON variable
            if(ssContextObjectScriptHTML){ 
                ssContextObject = JSON.parse(ssContextObjectScriptHTML[1] + "}");
            }
        }

        var ssRawProductDetail;
      	
        if(typeof(ssContextObject.product) != 'undefined'){

            // strip the information in the key "mainImage" from each product variant
            // it's a crazy mess of alphanumeric stuff that we don't need in our dataLayer
            var productVariants = ssContextObject.product.variants;            

            for(var i=0; i < productVariants.length; i++){
                productVariants[i]['mainImage'] = {};
            }

            // grab the category information from the element with id="productWrapper"
            // loop through its classes and find any class with "category-" in the title
            // remove the "category-" and append the rest of the class name to the productCategory variable
            // make sure to add a "/" in between each category
            var productWrapperElement = document.querySelector("#productWrapper");
            var productWrapperCategoryClasses = (productWrapperElement) ? productWrapperElement.className.match(/\bcategory-[\S]*/g) : [];
            var categoryString = "";

            for(var i=0; i < productWrapperCategoryClasses.length; i++){
                categoryString = categoryString + ( i!=0 ? "/" : "") + productWrapperCategoryClasses[i].replace(/category-/, '');
            }

            ssRawProductDetail = {
                "item": ssContextObject.item,
                "product": ssContextObject.product,
                "category": categoryString
            };
        }

        // push the anonymous transaction information to the dataLayer
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            'event' : 'ssRawProductDetailPush',
            'ssRawProductDetail': ssRawProductDetail
        });

    }


</script>